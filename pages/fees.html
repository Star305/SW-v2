        head: [['Date', 'Student', 'Amount', 'Method']],
        body: rows,
        startY: 110,
        headStyles: {
          fillColor: [26, 54, 93],
          textColor: 255
        },
        alternateRowStyles: {
          fillColor: [240, 240, 240]
        },
        styles: {
          cellPadding: 5,
          fontSize: 10
        }
      });
      
      // Save the PDF
      doc.save('fees_report.pdf');
    };

    // Export payments to Excel
    window.exportPayments = function() {
      // In a real app, you would use a library like SheetJS to export to Excel
      showNotification("Payments exported successfully!", "success");
    };

    // Refresh data
    window.refreshData = async function() {
      await loadInitialData();
      showNotification("Data refreshed successfully!", "success");
    };

    // Show user modal
    window.showUserModal = function() {
      document.getElementById('userModal').style.display = 'block';
    };

    // Save user
    window.saveUser = function() {
      const name = document.getElementById('userName').value;
      const email = document.getElementById('userEmail').value;
      const role = document.getElementById('userRole').value;
      const password = document.getElementById('userPassword').value;
      const confirmPassword = document.getElementById('userConfirmPassword').value;
      
      if (!name || !email || !role || !password || !confirmPassword) {
        showNotification("Please fill all required fields", "error");
        return;
      }
      
      if (password !== confirmPassword) {
        showNotification("Passwords do not match", "error");
        return;
      }
      
      // In a real app, you would create the user in Firebase Auth here
      showNotification("User created successfully!", "success");
      closeModal('userModal');
    };

    // Load settings
    function loadSettings() {
      document.getElementById('currencyPref').value = settings.currency;
      document.getElementById('exchangeRate').value = settings.exchangeRate;
      document.getElementById('paymentMethods').value = settings.paymentMethods.join(', ');
    }

    // Save settings
    window.saveSettings = function() {
      const currency = document.getElementById('currencyPref').value;
      const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);
      const paymentMethods = document.getElementById('paymentMethods').value.split(',').map(m => m.trim());
      
      if (!currency || isNaN(exchangeRate) || exchangeRate <= 0 || paymentMethods.length === 0) {
        showNotification("Please fill all settings with valid values", "error");
        return;
      }
      
      // Update local settings
      settings.currency = currency;
      settings.exchangeRate = exchangeRate;
      settings.paymentMethods = paymentMethods;
      
      // In a real app, you would save to Firebase here
      showNotification("Settings saved successfully!", "success");
    };

    // Hamburger menu toggle
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sideMenu = document.getElementById('sideMenu');
    hamburgerBtn.addEventListener('click', () => {
      sideMenu.classList.toggle('shown');
    });

    // Initialize the application
    (function initializeApp() {
      // Set up search functionality
      const studentSearch = document.getElementById('studentSearch');
      if (studentSearch) {
        studentSearch.addEventListener('input', filterStudents);
      }
      
      // Set up class filter change
      const classFilter = document.getElementById('studentFilterClass');
      if (classFilter) {
        classFilter.addEventListener('change', filterStudents);
      }
      
      // Set up stream filter change
      const streamFilter = document.getElementById('studentFilterStream');
      if (streamFilter) {
        streamFilter.addEventListener('change', filterStudents);
      }
      
      // Set up status filter change
      const statusFilter = document.getElementById('studentFilterStatus');
      if (statusFilter) {
        statusFilter.addEventListener('change', filterStudents);
      }
      
      // Set up report type change
      const reportType = document.getElementById('reportType');
      if (reportType) {
        reportType.addEventListener('change', function() {
          document.getElementById('studentSelectGroup').style.display = 
            this.value === 'student' ? 'block' : 'none';
        });
      }
      
      // Set up report period change
      const reportPeriod = document.getElementById('reportPeriod');
      if (reportPeriod) {
        reportPeriod.addEventListener('change', function() {
          document.getElementById('customDateRange').style.display = 
            this.value === 'custom' ? 'grid' : 'none';
        });
      }
    })();
  </script>
</body>
</html>
